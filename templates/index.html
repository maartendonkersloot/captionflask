<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <!-- UIkit CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.9.3/dist/css/uikit.min.css"/>

    <!-- UIkit JS -->
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.9.3/dist/js/uikit.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.9.3/dist/js/uikit-icons.min.js"></script>

    <style>
        .bg-image {
            position: fixed;
            z-index: -20;
            display: block;
            width: 100%;
            height: 100%;
            -webkit-filter: blur(3px);
            -moz-filter: blur(3px);
            -o-filter: blur(3px);
            -ms-filter: blur(3px);
            filter: blur(3px);
            background-size: cover;
            background-color: #F9C784;
            background-repeat: no-repeat;
        }

        .custom_container {
            background-color: #C44900;
            color: white;
        }

        .uk-table-striped tbody tr:nth-of-type(2n):last-child, .uk-table-striped > tr:nth-of-type(2n):last-child {
            border-bottom: 1px solid #e5e5e5;
            background-color: white;
            color: black;
        }
    </style>
</head>
<body>

<div class="bg-image">
</div>
<div class="uk-container custom_container">



    <form id="formid" method="post" enctype=multipart/form-data>
        <fieldset class="uk-fieldset">

            <legend class="uk-legend uk-text-large">Create Caption</legend>
            <div class="uk-margin">
                <label class="uk-form-label uk-text-large" for="form-stacked-text">Caption</label>
                <div class="uk-form-controls">
                    <textarea class="uk-textarea" id="caption" rows="5" type="text" name="caption" maxlength="240" required></textarea>
                </div>
            </div>
            <div class="uk-margin">
                <label class="uk-form-label uk-text-large" for="form-stacked-text">Image</label>
                <div class="uk-form-controls">

                        <span uk-icon="icon: cloud-upload"></span>
                        <span class="uk-text-middle">Attach binaries by dropping them here or</span>
                        <div>
                            <input type="file" name="file" id="file" accept="image/png, image/jpeg" required>
                        </div>
                </div>
            </div>

            <progress id="js-progressbar" class="uk-progress" value="0" max="100" hidden></progress>

            <input type="submit" class="uk-button uk-button-primary" value="Submit">
        </fieldset>

    </form>


<div class="tablecontainer">

</div>


</div>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type=text/javascript>
    $(document).ready(function () {

            $("#formid").submit(function(e) {
                e.preventDefault(); // avoid to execute the actual submit of the form.
                var caption = $('#caption').val();
                var file = $('#file')[0].files[0];
                form = new FormData();
                form.append('caption', caption);
                form.append('file', file);
                $.ajax({
                       type: "POST",
                       url: "{{ url_for('handle_data') }}",
                       data: form, // serializes the form's elements.
                    processData: false,
                contentType: false,
                       success: function(data)
                       {
                           $( ".tablecontainer" ).empty();
                            $( ".tablecontainer" ).append( data );
                            $('#caption').val('')
                           $('#file').val('')
                       }
                     });
            });

         $.ajax({
                type: 'POST',
                url: "{{url_for('get_postss')}}",
                  success: function(d){
                    $( ".tablecontainer" ).append( d );
                  }
            })

          $(".post").click(function () {
            clicked = $(this).attr("name");
            str = ".subreddit"+clicked
            varr = $(str + ':checkbox:checked')
            console.log(varr);
            var subs =  new Array();
            $.each( varr, function( key, value ) {
                subs.push(value.value)
                console.log(value.value)
            });
            $.ajax({
                type: 'POST',
                url: "{{url_for('reddit_post')}}",
                data: {'data': clicked,
                'subs':JSON.stringify(subs)},
                       success: function(data)
                       {
                           $( ".tablecontainer" ).empty();
                            $( ".tablecontainer" ).append( data );
                       }
            });
        });

         $(".edit").click(function () {
            clicked = $(this).attr("name");
              $.ajax({
                type: 'POST',
                url: "{{url_for('edit_post_path')}}",
                data: {'caption': $("#"+clicked).val(),
                'id': clicked},
                  success: function(d){
                    $( ".tablecontainer" ).empty();
                    $( ".tablecontainer" ).append( d );
                  }
            })
        });

         $(".delete").click(function () {
            clicked = $(this).attr("name");
              $.ajax({
                type: 'POST',
                url: "{{url_for('delete_post')}}",
                data: {'id': clicked},
                  success: function(d){
                    $( ".tablecontainer" ).empty();
                    $( ".tablecontainer" ).append( d );
                  }
            })
        });


    });
</script>

</body>
</html>