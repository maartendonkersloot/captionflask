<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <!-- UIkit CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.9.3/dist/css/uikit.min.css"/>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="https://pagination.js.org/dist/2.1.5/pagination.min.js"></script>
    <!-- UIkit JS -->
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.9.3/dist/js/uikit.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.9.3/dist/js/uikit-icons.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css"/>
    <style>
        .bg-image {
            position: fixed;
            z-index: -20;
            display: block;
            width: 100%;
            height: 100%;
            -webkit-filter: blur(3px);
            -moz-filter: blur(3px);
            -o-filter: blur(3px);
            -ms-filter: blur(3px);
            filter: blur(3px);
            background-size: cover;
            background-color: #F9C784;
            background-repeat: no-repeat;
        }

        .custom_container {
            background-color: #C44900;
            color: white;
        }

        .uk-table-striped tbody tr:nth-of-type(2n):last-child, .uk-table-striped > tr:nth-of-type(2n):last-child {
            border-bottom: 1px solid #e5e5e5;
            background-color: white;
            color: black;
        }
    </style>
</head>
<body>

<script>
    function previewFile(input) {
        var file = $("input[type=file]").get(0).files[0];

        if (file) {
            var reader = new FileReader();

            reader.onload = function () {
                $("#preview_img").attr("src", reader.result);
                $("#preview_img2").attr("src", reader.result);

            }

            reader.readAsDataURL(file);
        }
    }
</script>

<div class="bg-image">
</div>
<div class="uk-container custom_container">


    <form id="formid" method="post" enctype=multipart/form-data>
        <fieldset class="uk-fieldset">
            <legend class="uk-legend uk-text-large">Create Caption</legend>
            <div class="uk-margin" style="text-align: center;">
                <label class="uk-form-label uk-text-large" for="form-stacked-text">Caption</label>
                <div class="uk-form-controls">
                    <textarea class="uk-textarea" id="caption" rows="5" type="text" name="caption" maxlength="240"
                              required></textarea>
                </div>
            </div>
            <div class="uk-margin" style="text-align: center;">
                <label class="uk-form-label uk-text-large" for="form-stacked-text">Image</label>
                <div class="uk-form-controls">
                    <div class="uk-child-width-1-2@s uk-text-center" uk-grid>

                        <div>
                            <input onchange="previewFile(this);" type="file" name="file" id="file"
                                   accept="image/png, image/jpeg" class="uk-button uk-button-primary " required>
                        </div>
                        <div>
                            <a href="#ex1" rel="modal:open">
                                <img data-src="" width="100px" height="" alt="" id="preview_img" uk-img>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal HTML embedded directly into document -->
            <div id="ex1" class="modal">
                <img data-src="" width="" height="" alt="" id="preview_img2" uk-img>
                <a href="#" rel="modal:close">Close</a>
            </div>

            <!-- Link to open the modal -->


            <div class="uk-child-width-1-1@s uk-text-center uk-grid uk-margin" uk-grid="">
                <div class="uk-first-column">
                    <label class="uk-form-label uk-text-large" for="form-stacked-text">Subreddits</label>
                </div>

                <div class="uk-first-column">
                    <div class="uk-child-width-1-4@s uk-text-center" uk-grid>
                        {% for sub in subreddits %}
                            <div>
                                <label>
                                    <input class="uk-checkbox subreddit" type="checkbox" value="{{ sub }}"> {{ sub }}
                                </label>
                            </div>
                        {% endfor %}
                    </div>
                </div>

                <div class="uk-first-column">
                    <label class="uk-form-label uk-text-large " for="form-stacked-text">Submit</label>
                </div>

                <div class="uk-first-column">
                    <input type="submit" class="uk-button uk-button-primary submitbutton" value="Submit">
                </div>
            </div>


        </fieldset>
    </form>


    <div class="tablecontainer">

    </div>


</div>


<script type=text/javascript>
    $(document).ready(function () {

        $("#formid").submit(function (e) {
            e.preventDefault(); // avoid to execute the actual submit of the form.
            $(".submitbutton").prop('disabled', true);
            var caption = $('#caption').val();
            var file = $('#file')[0].files[0];
            varr = $(".subreddit" + ':checkbox:checked')
            var subreddits = ""
            $.each(varr, function (key, value) {
                if (subreddits === "") {
                    subreddits += value.value
                } else {
                    subreddits += ',' + value.value
                }
            });
            form = new FormData();
            form.append('caption', caption);
            form.append('file', file);
            form.append('subreddits', subreddits);


            $.ajax({
                type: "POST",
                url: "{{ url_for('handle_data') }}",
                data: form, // serializes the form's elements.
                processData: false,
                contentType: false,
                success: function (data) {
                    $(".tablecontainer").empty();
                    $(".tablecontainer").append(data);
                    $('#caption').val('')
                    $('#file').val('')
                    varr.prop("checked", false);
                    $(".submitbutton").prop('disabled', false);
                }
            });
        });

        $.ajax({
            type: 'POST',
            url: "{{url_for('get_postss')}}",
            success: function (d) {
                $(".tablecontainer").append(d);
            }
        })

        $(".post").click(function () {
            clicked = $(this).attr("name");
            str = ".subreddit" + clicked
            varr = $(str + ':checkbox:checked')

            $.ajax({
                type: 'POST',
                url: "{{url_for('reddit_post')}}",
                data: {
                    'data': clicked
                },
                success: function (data) {
                    $(".tablecontainer").empty();
                    $(".tablecontainer").append(data);
                }
            });
        });

        $(".edit").click(function () {
            clicked = $(this).attr("name");
            $.ajax({
                type: 'POST',
                url: "{{url_for('edit_post_path')}}",
                data: {
                    'caption': $("#" + clicked).val(),
                    'id': clicked
                },
                success: function (d) {
                    $(".tablecontainer").empty();
                    $(".tablecontainer").append(d);
                }
            })
        });

        $(".delete").click(function () {
            clicked = $(this).attr("name");
            $.ajax({
                type: 'POST',
                url: "{{url_for('delete_post')}}",
                data: {'id': clicked},
                success: function (d) {
                    $(".tablecontainer").empty();
                    $(".tablecontainer").append(d);
                }
            })
        });


    });
</script>

</body>
</html>